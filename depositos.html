<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>

    <link rel="stylesheet" href="css/depositos.css">
    <link rel="stylesheet" href="css/menu.css">
</head>

<body>

    <header>
       
        <h1>Gestion Taller Dynos</h1>
    </header>


    <h1 class="deposito">Deposito <span id="id" name="id"> </span></h1>
    <div class="area">
        <nav class="main-menu">
            <ul>
                <li>
                    <a href="index.php">
                        <i class="fa fa-home
                        fa-2x"></i>
                        <span class="nav-text">
                            Depositos
                        </span>
                    </a>
                </li>
                <li class="has-subnav
                ">
                    <a href="grafica.html">
                        <i class="fa fa-globe fa-2x"></i>
                        <span class="nav-text">
                            Informes
                        </span>
                    </a>
                </li>
                <li>
                    <a href="opciones.html">
                        <i class="fa fa-cogs
                        fa-2x"></i>
                        <span class="nav-text">
                            Ajustes
                        </span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>


        <div class="container">
            <!-- aqui van los formularios -->


            <form action="" method="POST" class="form" id="Myform">
                <h2>Datos del Cliente</h2>
                <div class="bloquenombre">

                    <input type="hidden" name="id" id="idc">
                    <input type="hidden" name="codigo_barras" id="codigo_barras">
                    <label for="name">Nombre:</label>
                    <input type="text" id="name" name="name" required>


                    <label for="email">Correo:</label>
                    <input type="email" id="email" name="email" >


                    <label for="phone">Telefono:</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="bloquenif">
                    <label for="dni">NIF/CIF:</label>
                    <input type="text" id="dni" name="dni" >

                    <label for="dni">Poblacion:</label>
                    <input type="text" id="poblacion" name="poblacion" >
                </div>
                <div class="bloquedireccion">
                    <label for="Direccion">Direccion:</label>
                    <input type="text" id="Direccion" name="Direccion" >

                    <label for="Codigo Postal">Codigo Postal:</label>
                    <input type="tel" id="CodigoP" name="CodigoP" >
                </div>
                
        
      

        
                <h2>Estado del Deposito</h2>
                <div class="bloqueestado">

                    <label for="estado">Estado:</label>
                    <select name="estado" id="estado">
                        <option value="1">Pendiente de revisar</option>
                        <option value="2">En revision o reparacion</option>
                        <option value="3">Terminado, pendiente de recogida</option>
                        <option value="4">Pendiente piezas</option>
                        <option value="5">En servicio externo</option>
                        <option value="6">Pendiente aceptacion presupuesto</option>
                        <option value="7">Pendiente RMA</option>
                        <option value="8">Abonado</option>
                        <option value="9">Entregado</option>

                    </select>

                    <label for="Resultado">Resultado reparacion</label>
                    <select name="Resultado" id="Resultado">
                        <option value="1"> No decidido</option>
                        <option value="2"> Diagnosticado,sin solucion </option>
                        <option value="3"> Solucionado</option>
                        <option value="4">Diagnosticado, Presupuesto no aceptado </option>
                    </select>
                </div>
                <div class="bloquefecha">
                    <label for="fecha">Fecha de entrada:</label>
                    <input type="text" id="fecha" name="fecha" readonly>
                    <label for="fehaR">Fecha de Retirada</label>
                    <input type="text" id="fechaR" name="fechaR" readonly>

                </div>
           
            <div class="bloquebotones">
                <button  type="button" class="botones" onclick="TerminadoSolu()">Terminado + Solucíon</button>
                <button type="button" class="botones" onclick="TerminadoNoSolu()">Terminado + Sin Solucíon</button>
                <button  type="button" class="botones" onclick="Retirar()">Retirar Ahora</button>
            </div>


            <hr>
            <h2>Datos Del Deposito</h2>
            
                <div class="bloquedatos">
                    <label for="DatosDeposita">Datos que deposita</label>
                    <textarea name="DatosDeposita" id="DatosDeposita" style="width: 100%;" rows="3"></textarea>
                    <label for="Problemas">Problemas a resolver</label>
                    <textarea name="Problemas" id="Problemas" style="width: 100%;" rows="3"></textarea>
                    <label for="Solucion">Solucion</label>
                    <textarea name="Solucion" id="Solucion" style="width: 100%;" rows="3"></textarea>
                </div>
          
            <h2>Informacion adicional</h2>
            
                <div class="bloquenombre">
                    <label for="Empleado">Empleado</label>
                    <select name="Empleado" id="Empleado">
                        <option value="1">MARIPAZ</option>
                        <option value="2">PEDRO</option>
                        <option value="3">ROSA</option>
                        <option value="3">LOBATO</option>
                    </select>
                    <label for="Contraseña">Contraseña S.O</label>
                    <input type="text" id="Contraseña" name="Contraseña">
                    <label for="Prioridad">Prioridad</label>

                    <select name="Prioridad" id="Prioridad">
                        <option value="1">Baja</option>
                        <option value="2">Media</option>
                        <option value="3">Alta</option>

                    </select>
                </div>
                <label for="Nserie">Nº Serie</label>
                <input type="text" name="Nserie" id="Nserie"> </input>
                <div class="bloquenombre">
                    <label for="Albaran">Albaran</label>
                    <input type="text" id="Albaran" name="Albaran">
                    <label for="Presupuesto">Presupuesto</label>
                    <input type="text" id="Presupuesto" name="Presupuesto">
                    <label for="Adelantado">Adelantado</label>
                    <input type="text" id="Adelantado" name="Adelantado">
                </div>
            </form>

      
        <h2>Albaran</h2>
        <!-- ... el resto de tu código HTML ... -->
        <form action="" class="albaran" id="">
            <table>
                <thead>
                    <tr>
                        <th>Descripción</th>
                        <th>Número de Serie</th>
                        <th>Precio</th>
                        <th>Precio + IVA</th>
                        <th>Cantidad</th>
                        <th>Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" class="descripcion" name="descripcion"></td>
                        <td><input type="text" class="num_serie" name="num_serie"></td>
                        <td><input type="text" class="precio" name="precio"></td>
                        <td><input type="text" class="precio_iva" name="precio_iva" readonly></td>
                        <td><input type="text" class="cantidad" name="cantidad"></td>
                        <td><input type="text" class="importe" name="importe" readonly></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="descripcion" name="descripcion"></td>
                        <td><input type="text" class="num_serie" name="num_serie"></td>
                        <td><input type="text" class="precio" name="precio"></td>
                        <td><input type="text" class="precio_iva" name="precio_iva" readonly></td>
                        <td><input type="text" class="cantidad" name="cantidad"></td>
                        <td><input type="text" class="importe" name="importe" readonly></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="descripcion" name="descripcion"></td>
                        <td><input type="text" class="num_serie" name="num_serie"></td>
                        <td><input type="text" class="precio" name="precio"></td>
                        <td><input type="text" class="precio_iva" name="precio_iva" readonly></td>
                        <td><input type="text" class="cantidad" name="cantidad"></td>
                        <td><input type="text" class="importe" name="importe" readonly></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="descripcion" name="descripcion"></td>
                        <td><input type="text" class="num_serie" name="num_serie"></td>
                        <td><input type="text" class="precio" name="precio"></td>
                        <td><input type="text" class="precio_iva" name="precio_iva" readonly></td>
                        <td><input type="text" class="cantidad" name="cantidad"></td>
                        <td><input type="text" class="importe" name="importe" readonly></td>
                    </tr>
                    <!-- Puedes agregar más filas aquí si es necesario -->
                </tbody>
            </table>

            <div>
                <label for="base_imponible">Base Imponible:</label>
                <input type="text" id="base_imponible" name="base_imponible" readonly>
            </div>

            <div>
                <label for="iva">IVA (21%):</label>
                <input type="text" id="iva" name="iva" readonly>
            </div>

            <div>
                <label for="total">Total:</label>
                <input type="text" id="total" name="total" readonly>
            </div>
        </form>
    </div>
</div>
<button class="button" onclick="actualizarbd()">Actaulizar</button>
    </div>
    
    </div>

    <!-- ... el resto de tu código HTML ... -->
   
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
          

          
        const rows = document.querySelectorAll('.albaran tbody tr');

        rows.forEach(row => {
            const inputs = row.querySelectorAll('input');

            inputs.forEach(input => {
                input.addEventListener('input', function () {
                    calculateRow(row);
                });
            });
        });

        function calculateRow(row) {
            const precio = parseFloat(row.querySelector('.precio').value);
            const cantidad = parseFloat(row.querySelector('.cantidad').value);
            const precioIva = precio * 1.21;
            const importe = precio * cantidad;
            row.querySelector('.precio_iva').value = precioIva.toFixed(2);
            row.querySelector('.importe').value = importe.toFixed(2);
            calculateTotals();
        }

        function calculateTotals() {
            const importes = Array.from(document.querySelectorAll('.importe')).map(input => parseFloat(input.value) || 0);
            const baseImponible = importes.reduce((acc, cur) => acc + cur, 0);
            const iva = baseImponible * 0.21;
            const total = baseImponible + iva;
            document.getElementById('base_imponible').value = baseImponible.toFixed(2);
            document.getElementById('iva').value = iva.toFixed(2);
            document.getElementById('total').value = total.toFixed(2);
        }
    });
        
        function TerminadoSolu() {

            //poner estado en terminado pendiente de recojida y el estado en olucionado

            var estado = document.getElementById("estado");
            estado.value = 3;//coresponde a terminado pendiente de recojida

            var resultado = document.getElementById("Resultado");
            resultado.value = 3;//corresponde a diagnosticado

            ponerfecha();

        }
        function TerminadoNoSolu() {
            //poner estado en terminado pendiente de recojida y el estado en olucionado

            var estado = document.getElementById("estado");
            estado.value = 3;//coresponde a terminado pendiente de recojida

            var resultado = document.getElementById("Resultado");
            resultado.value = 2;//corresponde a diagnosticado

            ponerfecha();
        }
        function ponerfecha() {
            var fecha = new Date();
            var dia = fecha.getDate();
            var mes = fecha.getMonth() + 1; // Add 1 to get the correct month
            var año = fecha.getFullYear();
            var hora = fecha.getHours();
            var minutos = fecha.getMinutes();
            var fechaactual = año + "-" + mes + "-" + dia + " " + hora + ":" + minutos;
            var Ifecha = document.getElementById("fechaR");
            Ifecha.value = fechaactual; // Use value instead of InnerHtml to set the input field value
        }
    </script>
    <script src="script/deposito.js"></script>

</body>

</html>